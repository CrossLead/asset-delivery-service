{"version":3,"sources":["deliverer.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;IAOqB,S;;;;;;;AAMnB,qBAAY,OAAZ,EAAqB,YAArB,EAAmC;AAAA;;AACjC,QAAI,IAAJ,CAAS,IAAT,EAAe,UAAf,EAA2B,OAA3B;AACA,QAAI,IAAJ,CAAS,IAAT,EAAe,eAAf,EAAgC,YAAhC;AACD;;;;;;;;;;;;;;YAOO,Q;;;;;AAAA,wB,GAAW,KAAK,aAAL,CAAmB,GAAnB,CAAwB,gBAAQ;AAC/C,yBAAO,MAAK,QAAL,CAAc,GAAd;AAAA,yFAAmB,iBAAO,GAAP;AAAA,0BAClB,MADkB,EAElB,QAFkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCACH,IAAI,SAAJ,EADG;;AAAA;AAClB,oCADkB;AAElB,sCAFkB,GAEP,IAAI,KAFG;AAAA;AAAA,qCAGlB,KAAK,IAAL,CAAU,MAAV,EAAkB,QAAlB,CAHkB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAAnB;AAAA;AAAA;AAAA;AAAA,sBAAP;AAKD,iBANgB,C;;uBAQL,kBAAQ,GAAR,CAAa,iBAAE,WAAF,CAAc,QAAd,CAAb,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;2BAQP,G,EAAK;AACV,UAAI,IAAJ,CAAS,IAAT,EAAe,UAAf,EAA2B,GAA3B;AACD;;;;;;;;8BAKS,G,EAAK;AACb,UAAI,IAAJ,CAAS,IAAT,EAAe,UAAf,EAA2B,GAA3B;AACD;;;;;;;;;2BAMM,G,EAAK;AACV,UAAI,IAAJ,CAAS,IAAT,EAAe,UAAf,EAA2B,GAA3B;AACD;;;;;;;;8BAKS,G,EAAK;AACb,UAAI,IAAJ,CAAS,IAAT,EAAe,UAAf,EAA2B,GAA3B;AACD;;;;;;;;;4BAMO,I,EAAM;AACZ,UAAI,IAAJ,CAAS,IAAT,EAAe,eAAf,EAAgC,IAAhC;AACD;;;;;;;;mCAKc,I,EAAM;AACnB,UAAI,IAAJ,CAAS,IAAT,EAAe,eAAf,EAAgC,IAAhC;AACD;;;;;;;;;4BAMO,I,EAAM;AACZ,UAAI,IAAJ,CAAS,IAAT,EAAe,eAAf,EAAgC,IAAhC;AACD;;;;;;;;mCAKc,I,EAAM;AACnB,UAAI,IAAJ,CAAS,IAAT,EAAe,eAAf,EAAgC,IAAhC;AACD;;;;;kBAtFkB,S;;;AAyFrB,SAAS,GAAT,CAAa,IAAb,EAAmB,IAAnB,EAAyB;AACvB,MAAI,gBAAgB,KAApB,EAA2B;AACzB,SAAK,IAAL,IAAa,IAAb;AACD,GAFD,MAEO;AACL,SAAK,IAAL,IAAa,OAAO,CAAC,IAAD,CAAP,GAAgB,EAA7B;AACD;AACF;;AAED,SAAS,GAAT,CAAa,IAAb,EAAmB,IAAnB,EAAyB;AACvB,OAAK,IAAL,EAAW,IAAX,CAAgB,IAAhB;AACD","file":"deliverer.js","sourcesContent":["import _ from 'lodash';\n\n/**\n * @class Deliverer\n * @description\n *   Deliver emails to a destination that have the source as an attachment\n */\nexport default class Deliverer {\n\n  /**\n   * @param  {Source[]} [sources]\n   * @param  {Destination[]} [destinations]\n   */\n  constructor(sources, destinations) {\n    set.call(this, '_sources', sources);\n    set.call(this, '_destinations', destinations);\n  }\n\n  /**\n   * Submit the source to destinations\n   * @return {Promise}\n   */\n  async send() {\n    const promises = this._destinations.map( dest => {\n      return this._sources.map( async (src) => {\n        const assets = await src.getAssets();\n        const filePath = src._path;\n        await dest.send(assets, filePath);\n      })\n    });\n\n   return await Promise.all( _.flattenDeep(promises) );\n  }\n\n  /**\n   * Set the sources collection\n   * Resets the sources collection\n   * @param {Source|Source[]} src\n   */\n  setSrc(src) {\n    set.call(this, '_sources', src);\n  }\n\n  /**\n   * @alias setSrc\n   */\n  setSource(src) {\n    set.call(this, '_sources', src);\n  }\n\n  /**\n   * Push a source to the sources collection\n   * @param {Source} src\n   */\n  addSrc(src) {\n    add.call(this, '_sources', src);\n  }\n\n  /**\n   * @alias addSrc\n   */\n  addSource(src) {\n    add.call(this, '_sources', src);\n  }\n\n  /**\n   * Set the destinations collection\n   * @param {Destination|Destination[]} dest\n   */\n  setDest(dest) {\n    set.call(this, '_destinations', dest);\n  }\n\n  /**\n   * @alias setDest\n   */\n  setDestination(dest) {\n    set.call(this, '_destinations', dest);\n  }\n\n  /**\n   * Add a destination to the destinations collection\n   * @param {Destination} dest\n   */\n  addDest(dest) {\n    add.call(this, '_destinations', dest);\n  }\n\n  /**\n   * @alias addDest\n   */\n  addDestination(dest) {\n    add.call(this, '_destinations', dest);\n  }\n}\n\nfunction set(type, data) {\n  if (data instanceof Array) {\n    this[type] = data;\n  } else {\n    this[type] = data ? [data] : [];\n  }\n}\n\nfunction add(type, data) {\n  this[type].push(data);\n}\n"],"sourceRoot":"/source/"}